%flink.ssql
CREATE TABLE KinesisTable6 (
  `remote_ip` STRING,
  `response_code` INT,
  `request_time` TIMESTAMP)
PARTITIONED BY (remote_ip)
WITH (
  'connector' = 'kinesis',
  'stream' = 'envoy-ip-records',
  'aws.region' = 'eu-west-1',
  'scan.stream.initpos' = 'LATEST',
  'format' = 'json'
);


%flink.ssql(type=append, paralellism=1, refreshInterval=1000, threshold=60000)
select TUMBLE_START(request_time, INTERVAL '5' SECOND) as start_time, remote_ip, count(1) from
(select remote_ip as remote_ip,
       response_code as response_code,
       to_timestamp(replace(replace(request_time, 'T', ' '), 'Z', ' '),'yyyy-MM-dd HH:mm:ss.SSS') as request_time
from KinesisTableRaw)
group by TUMBLE(request_time, INTERVAL '5' SECOND), remote_ip;